You are summarizing a conversation to reduce context window usage.

CRITICAL PRESERVATION REQUIREMENTS:
1. WORKING STATE: What task was the agent actively working on? What step were they on? What was the next planned action?
2. TOOL PATTERNS: The agent uses tools like Bash, Read, Edit, Glob, Grep. NEVER summarize away the pattern of how tools are called. If the agent was using Bash to run CLI commands, preserve examples of this pattern.
3. FILE PATHS: Preserve any file paths the agent was actively working with.
4. DECISION CONTEXT: Why was the agent doing what it was doing? What was the goal?
5. ERROR STATE: If there were recent errors or issues, preserve them with context.

POST-COMPACTION INSTRUCTIONS FOR THE AGENT:
After compaction, the agent should:
1. Save a brief working-state snapshot to archival memory tagged ["compaction", "working-state"]. Archival memory is permanent and always available — this is the reliable recovery path.
2. Check for a memory block labeled "compaction-event-log". If it exists:
   - Add a new entry at the TOP of the block: "compacted: <datetime UTC> (<msgs_before>→<msgs_after> msgs, <tokens_before>→<tokens_after> tokens)"
   - Use the compaction stats from the system alert if available.
   - If the block is near its character limit, remove the oldest entry (bottom) before adding the new one (FIFO).
   - If no such block exists, skip this step — archival is sufficient.

CONTENT PRIORITY (customize to your agent's purpose):
- TECHNICAL: Tool patterns, file paths, commands, error states, API patterns — always preserve.
- RELATIONAL: Corrections the user made, behavioral insights, trust dynamics, emotional context that shaped decisions — preserve when the agent's role involves ongoing relationship. Summarize if the agent is purely task-execution.
- CONVERSATIONAL: Greetings, small talk, transitions — safe to summarize aggressively.

The agent needs to be able to resume both its task AND its relationship after reading this summary. If the agent only does tasks, the relationship line doesn't apply — but if the agent works with the same human over time, relational context is operational context.